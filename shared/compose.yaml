services:
  mc-router:
    image: itzg/mc-router
    container_name: mc-router
    restart: unless-stopped
    networks:
      - default
      - proxy
    ports:
      - name: minecraft
        target: 25565
        published: 25565
    environment:
      DOCKER_SOCKET: tcp://socket-proxy:2375
      IN_DOCKER: "true"
    
  nginx:
    image: webdevops/php-nginx:8.4-alpine
    restart: unless-stopped
    networks:
      default:
      proxy:
        aliases:
          - mc-nginx
    volumes:
      - type: bind
        source: ./vhost.conf
        target: /opt/docker/etc/nginx/vhost.conf
        read_only: true
    labels:
      - traefik.http.routers.mc-backup.rule=Host(`backup.off-topic.chat`)
      - traefik.http.services.mc-backup.loadbalancer.server.url=http://mc-nginx:81
      - traefik.http.routers.mc-modpack.rule=Host(`modpack.off-topic.chat`)
      - traefik.http.services.mc-modpack.loadbalancer.server.url=http://mc-nginx:82

networks:
  default:
  proxy:
    name: proxy_default
    external: true